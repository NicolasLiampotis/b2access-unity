<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:context="http://www.springframework.org/schema/context"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<context:annotation-config/>
	<bean class="pl.edu.icm.unity.server.JettyServer"/>
	<bean class="pl.edu.icm.unity.server.UnityApplication$InnerServerLifecycle"/>
	<bean class="pl.edu.icm.unity.server.UnityApplication$ShutdownFinished"/>

	<bean id="proxyBuilder" class="pl.edu.icm.unity.engine.events.EventProxyBuilder"/>
	<bean class="pl.edu.icm.unity.engine.events.EventProcessor"/>
	
	<!-- Proxied beans which are the ultimate implementation of the core interface. Proxies
			binds with the events mechanism. -->
	<bean primary="true" factory-bean="proxyBuilder" factory-method="getAttributeManagementInstance"/>
	<bean primary="true" factory-bean="proxyBuilder" factory-method="getGroupsManagementInstance"/>
	<bean primary="true" factory-bean="proxyBuilder" factory-method="getIdentitiesManagementInstance"/>
	<bean primary="true" factory-bean="proxyBuilder" factory-method="getServerManagementInstance"/>
	<bean primary="true" factory-bean="proxyBuilder" factory-method="getEndpointsManagementInstance"/>
	<bean primary="true" factory-bean="proxyBuilder" factory-method="getAuthenticationManagementInstance"/>

	<!-- The real implementation, with a real authorization module injected. However those beans are plain,
	are not generating any events. -->	
	<bean primary="false" class="pl.edu.icm.unity.engine.GroupsManagementImpl">
		<qualifier value="plain"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.IdentitiesManagementImpl">
		<qualifier value="plain"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.AttributesManagementImpl">
		<qualifier value="plain"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.AuthenticationManagementImpl">
		<qualifier value="plain"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.ServerManagementImpl">
		<qualifier value="plain"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.EndpointManagementImpl">
		<qualifier value="plain"/>
	</bean>
	
	<!-- Those beans are the same as the 'primary' beans above, but do not perform authorization. 
	Must be used with qualifier. -->
	<bean primary="false" class="pl.edu.icm.unity.engine.GroupsManagementImpl">
		<qualifier value="insecure"/>
		<constructor-arg name="authz" ref="noauthz"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.IdentitiesManagementImpl">
		<qualifier value="insecure"/>
		<constructor-arg name="authz" ref="noauthz"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.AttributesManagementImpl">
		<qualifier value="insecure"/>
		<constructor-arg name="authz" ref="noauthz"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.AuthenticationManagementImpl">
		<qualifier value="insecure"/>
		<constructor-arg name="authz" ref="noauthz"/>
	</bean>
	<bean primary="false" class="pl.edu.icm.unity.engine.ServerManagementImpl">
		<qualifier value="insecure"/>
		<constructor-arg name="authz" ref="noauthz"/>
	</bean>	
	<bean primary="false" class="pl.edu.icm.unity.engine.EndpointManagementImpl">
		<qualifier value="insecure"/>
		<constructor-arg name="authz" ref="noauthz"/>
	</bean>

	<bean class="pl.edu.icm.unity.engine.internal.InternalEndpointManagement"/>
	<bean class="pl.edu.icm.unity.engine.internal.EngineInitialization"/>
	<bean class="pl.edu.icm.unity.engine.internal.EngineHelper"/>
	<bean class="pl.edu.icm.unity.engine.internal.IdentityResolverImpl"/>
	<bean class="pl.edu.icm.unity.engine.internal.EndpointsUpdater"/>
	<bean class="pl.edu.icm.unity.engine.internal.AttributeStatementsCleaner"/>
	
	<bean primary="true" class="pl.edu.icm.unity.engine.authz.AuthorizationManagerImpl"/>
	<bean primary="false" name="noauthz" class="pl.edu.icm.unity.engine.authz.InternalNoAuthzImpl"/>

	<bean class="pl.edu.icm.unity.sysattrs.SystemAttributeTypes"/>
</beans>